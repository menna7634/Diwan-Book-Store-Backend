import{E as l,Ja as b,Ya as g,f as p,h as s,j as u,o,r as h,v as m}from"./chunk-VTSCHVBM.js";var C=class c{API="http://localhost:3000";http=m(g);_cart=l({items:[],totalItems:0,subtotal:0,shipping:0,total:0});cart=this._cart.asReadonly();cartCount=b(()=>this._cart().totalItems);constructor(){}mapCart(t){let a=t.items.map(e=>{let i=typeof e.book_id=="object",d=i?e.book_id:null;return{id:e._id,bookId:i?e.book_id._id:e.book_id,title:d?.book_title??"Unknown Title",imageUrl:d?.book_cover_url??"",price:e.price,quantity:e.quantity}}),r=a.reduce((e,i)=>e+i.price*i.quantity,0),n=r===0||r>=50?0:5.99;return{items:a,totalItems:a.reduce((e,i)=>e+i.quantity,0),subtotal:r,shipping:n,total:r+n}}loadCart(){this.http.get(`${this.API}/cart`).pipe(s(t=>this.mapCart({_id:"",user_id:"",items:t.data.data,total:t.data.total})),u(()=>p(this._cart()))).subscribe(t=>this._cart.set(t))}addToCart(t,a,r){return this.http.post(`${this.API}/cart/items`,{bookId:t,quantity:a,price:r}).pipe(s(n=>this.mapCart(n.data.cart)),o(n=>this._cart.set(n)))}setQuantity(t,a){return this.http.patch(`${this.API}/cart/items/${t}`,{quantity:a}).pipe(s(r=>this.mapCart(r.data.cart)),o(r=>this._cart.set(r)))}increaseQuantity(t,a=1){return this.http.patch(`${this.API}/cart/items/${t}/increase`,{step:a}).pipe(s(r=>this.mapCart(r.data.cart)),o(r=>this._cart.set(r)))}decreaseQuantity(t,a=1){return this.http.patch(`${this.API}/cart/items/${t}/decrease`,{step:a}).pipe(s(r=>this.mapCart(r.data.cart)),o(r=>this._cart.set(r)))}removeItem(t){return this.http.delete(`${this.API}/cart/items/${t}`).pipe(s(a=>this.mapCart(a.data.cart)),o(a=>this._cart.set(a)))}clearCart(){return this.http.delete(`${this.API}/cart`).pipe(s(t=>this.mapCart(t.data.cart)),o(t=>this._cart.set(t)))}placeOrder(t){return this.http.post(`${this.API}/order`,t).pipe(s(a=>a.data.order))}getMyOrders(t=1,a=10){return this.http.get(`${this.API}/order/my`,{params:{page:t,limit:a}}).pipe(s(r=>({data:r.data,totalPages:r.pagination?.totalPages??1,currentPage:r.pagination?.page??1})))}getOrderById(t){return this.http.get(`${this.API}/order/${t}`).pipe(s(a=>a.data.order))}static \u0275fac=function(a){return new(a||c)};static \u0275prov=h({token:c,factory:c.\u0275fac,providedIn:"root"})};export{C as a};
