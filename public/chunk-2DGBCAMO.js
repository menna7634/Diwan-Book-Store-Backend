import{a as Z,b as ee}from"./chunk-5JUGGBCD.js";import{a as te,c as ie,f as ne,q as re,s as oe}from"./chunk-YB375EBC.js";import{a as ae}from"./chunk-B2KEH2H4.js";import{$a as J,C as j,Ca as S,Fa as M,Ga as H,Ha as W,J as N,Ka as w,L as n,O as b,Oa as E,P as _,Pa as h,Sa as z,T as p,Ua as Y,Va as y,Xa as q,Ya as G,aa as l,ba as o,bb as K,ca as r,cb as Q,da as L,fb as X,ja as f,ka as g,la as d,ma as V,pa as I,qa as s,r as B,ra as R,sa as c,ta as D,u as O,v as u,va as A,w as v,wa as $,x,xa as U}from"./chunk-VTSCHVBM.js";var k=class t{constructor(i){this.http=i}apiUrl=`${Z.apiUrl}/reviews`;getReviews(i,e=1,a=10){let m=new q().set("book_id",i).set("page",e).set("limit",a);return this.http.get(this.apiUrl,{params:m})}addReview(i){return this.http.post(this.apiUrl,i)}deleteReview(i){return this.http.delete(`${this.apiUrl}/${i}`)}static \u0275fac=function(e){return new(e||t)(O(G))};static \u0275prov=B({token:t,factory:t.\u0275fac,providedIn:"root"})};var pe=()=>[1,2,3,4,5];function ge(t,i){if(t&1&&(o(0,"div",11),s(1),r()),t&2){let e=d();n(),c(" ",e.successMessage," ")}}function ve(t,i){if(t&1&&(o(0,"div",12),s(1),r()),t&2){let e=d();n(),c(" ",e.errorMessage," ")}}function xe(t,i){if(t&1){let e=f();o(0,"span",13),g("click",function(){let m=v(e).$implicit,C=d();return x(C.setRating(m))}),s(1," \u2605 "),r()}if(t&2){let e=i.$implicit,a=d();I(e<=a.selectedRating?"text-yellow-400":"text-gray-300")}}var P=class t{constructor(i,e){this.reviewService=i;this.cdr=e}bookId="";reviewAdded=new j;selectedRating=0;comment="";isLoading=!1;successMessage="";errorMessage="";setRating(i){this.selectedRating=i}submitReview(){if(this.selectedRating===0){this.errorMessage="Please select a rating";return}this.isLoading=!0,this.errorMessage="",this.successMessage="",this.reviewService.addReview({book_id:this.bookId,rating:this.selectedRating,comment:this.comment}).subscribe({next:()=>{this.successMessage="Review added successfully!",this.selectedRating=0,this.comment="",this.isLoading=!1,this.reviewAdded.emit(),this.cdr.detectChanges()},error:i=>{this.errorMessage=i.error?.details||"Failed to add review",this.isLoading=!1,this.cdr.detectChanges()}})}static \u0275fac=function(e){return new(e||t)(b(k),b(w))};static \u0275cmp=_({type:t,selectors:[["app-review-form"]],inputs:{bookId:"bookId"},outputs:{reviewAdded:"reviewAdded"},decls:19,vars:8,consts:[[1,"mt-6","bg-white","rounded-xl","p-6","shadow-sm","border","border-gray-100"],[1,"text-lg","font-bold","text-textMain","mb-4"],["class","bg-green-50 text-green-600 text-sm p-3 rounded mb-4",4,"ngIf"],["class","bg-red-50 text-red-500 text-sm p-3 rounded mb-4",4,"ngIf"],[1,"mb-4"],[1,"text-sm","text-textSub","mb-2"],[1,"flex","gap-1"],["class","text-3xl cursor-pointer hover:text-yellow-400 transition-colors",3,"class","click",4,"ngFor","ngForOf"],["rows","3","maxlength","500","placeholder","Share your thoughts about this book...",1,"w-full","border","border-gray-200","rounded-lg","p-3","text-sm","text-textMain","focus:outline-none","focus:border-primary","resize-none",3,"ngModelChange","ngModel"],[1,"text-xs","text-gray-400","text-right","mt-1"],[1,"w-full","bg-primary","text-white","py-3","rounded-lg","font-medium","disabled:opacity-40","hover:opacity-90","transition-opacity",3,"click","disabled"],[1,"bg-green-50","text-green-600","text-sm","p-3","rounded","mb-4"],[1,"bg-red-50","text-red-500","text-sm","p-3","rounded","mb-4"],[1,"text-3xl","cursor-pointer","hover:text-yellow-400","transition-colors",3,"click"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"h3",1),s(2,"Write a Review"),r(),p(3,ge,2,1,"div",2)(4,ve,2,1,"div",3),o(5,"div",4)(6,"p",5),s(7,"Your Rating *"),r(),o(8,"div",6),p(9,xe,2,2,"span",7),r()(),o(10,"div",4)(11,"p",5),s(12,"Your Comment (optional)"),r(),o(13,"textarea",8),U("ngModelChange",function(C){return $(a.comment,C)||(a.comment=C),C}),s(14,"    "),r(),o(15,"p",9),s(16),r()(),o(17,"button",10),g("click",function(){return a.submitReview()}),s(18),r()()),e&2&&(n(3),l("ngIf",a.successMessage),n(),l("ngIf",a.errorMessage),n(5),l("ngForOf",S(7,pe)),n(4),A("ngModel",a.comment),n(3),c(" ",a.comment.length," / 500 "),n(),l("disabled",a.isLoading||a.selectedRating===0),n(),c(" ",a.isLoading?"Submitting...":"Submit Review"," "))},dependencies:[y,E,h,oe,te,ie,re,ne],encapsulation:2})};var ce=()=>[1,2,3,4,5];function fe(t,i){if(t&1&&(o(0,"span",11),s(1,"\u2605"),r()),t&2){let e=i.$implicit,a=d();I(e<=a.avgRating?"text-yellow-400":"text-gray-300")}}function ue(t,i){t&1&&(o(0,"div",12),s(1," Loading reviews... "),r())}function be(t,i){if(t&1&&(o(0,"div",13),s(1),r()),t&2){let e=d();n(),c(" ",e.errorMessage," ")}}function _e(t,i){t&1&&(o(0,"div",14),s(1," No reviews yet. Be the first to review! "),r())}function we(t,i){if(t&1&&(o(0,"span",23),s(1,"\u2605"),r()),t&2){let e=i.$implicit,a=d().$implicit;I(e<=a.rating?"text-yellow-400":"text-gray-300")}}function he(t,i){if(t&1&&(o(0,"p",24),s(1),r()),t&2){let e=d().$implicit;n(),c(" ",e.comment," ")}}function ye(t,i){if(t&1&&(o(0,"div",15)(1,"div",16)(2,"div",17)(3,"div",18),s(4),r(),o(5,"span",19),s(6),r()(),o(7,"div",3),p(8,we,2,2,"span",20),r()(),p(9,he,2,1,"p",21),o(10,"p",22),s(11),M(12,"date"),r()()),t&2){let e=i.$implicit;n(4),c(" ",e.user_id==null||e.user_id.firstname==null?null:e.user_id.firstname.charAt(0).toUpperCase()," "),n(2),D(" ",e.user_id==null?null:e.user_id.firstname," ",e.user_id==null?null:e.user_id.lastname," "),n(2),l("ngForOf",S(9,ce)),n(),l("ngIf",e.comment),n(2),c(" ",W(12,6,e.createdAt,"mediumDate")," ")}}function ke(t,i){if(t&1){let e=f();o(0,"div",25)(1,"button",26),g("click",function(){v(e);let m=d();return x(m.prevPage())}),s(2," Previous "),r(),o(3,"span",27),s(4),r(),o(5,"button",28),g("click",function(){v(e);let m=d();return x(m.nextPage())}),s(6," Next "),r()()}if(t&2){let e=d();n(),l("disabled",e.currentPage===1),n(3),D(" ",e.currentPage," / ",e.totalPages," "),n(),l("disabled",e.currentPage===e.totalPages)}}var T=class t{constructor(i,e){this.reviewService=i;this.cdr=e}bookId="";reviews=[];avgRating=0;totalReviews=0;currentPage=1;totalPages=1;isLoading=!1;errorMessage="";ngOnInit(){this.loadReviews()}loadReviews(){this.isLoading=!0,this.errorMessage="",this.reviewService.getReviews(this.bookId,this.currentPage).subscribe({next:i=>{this.reviews=i.data.data,this.avgRating=i.data.avgRating,this.totalReviews=i.data.totalReviews,this.totalPages=i.data.pagination.totalPages,this.isLoading=!1,this.cdr.detectChanges()},error:()=>{this.errorMessage="Failed to load reviews",this.isLoading=!1,this.cdr.detectChanges()}})}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadReviews())}prevPage(){this.currentPage>1&&(this.currentPage--,this.loadReviews())}onReviewDeleted(){this.loadReviews()}static \u0275fac=function(e){return new(e||t)(b(k),b(w))};static \u0275cmp=_({type:t,selectors:[["app-review-list"]],inputs:{bookId:"bookId"},decls:14,vars:9,consts:[[1,"mt-8"],[1,"flex","items-center","gap-3","mb-6"],[1,"text-3xl","font-bold","text-primary"],[1,"flex","gap-1"],["class","text-xl",3,"class",4,"ngFor","ngForOf"],[1,"text-sm","text-textSub"],["class","text-center py-6 text-textSub",4,"ngIf"],["class","bg-red-50 text-red-500 text-sm p-3 rounded mb-4",4,"ngIf"],["class","text-textSub text-sm py-4",4,"ngIf"],["class","border-b border-gray-100 py-4",4,"ngFor","ngForOf"],["class","flex justify-center gap-4 mt-6",4,"ngIf"],[1,"text-xl"],[1,"text-center","py-6","text-textSub"],[1,"bg-red-50","text-red-500","text-sm","p-3","rounded","mb-4"],[1,"text-textSub","text-sm","py-4"],[1,"border-b","border-gray-100","py-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","rounded-full","bg-primary","text-white","flex","items-center","justify-center","text-sm","font-bold"],[1,"font-medium","text-textMain"],["class","text-sm",3,"class",4,"ngFor","ngForOf"],["class","text-textSub text-sm",4,"ngIf"],[1,"text-xs","text-gray-400","mt-1"],[1,"text-sm"],[1,"text-textSub","text-sm"],[1,"flex","justify-center","gap-4","mt-6"],[1,"px-4","py-2","rounded","bg-gray-100","text-textMain","disabled:opacity-40",3,"click","disabled"],[1,"py-2","text-textSub","text-sm"],[1,"px-4","py-2","rounded","bg-primary","text-white","disabled:opacity-40",3,"click","disabled"]],template:function(e,a){e&1&&(o(0,"div",0)(1,"div",1)(2,"span",2),s(3),r(),o(4,"div")(5,"div",3),p(6,fe,2,2,"span",4),r(),o(7,"p",5),s(8),r()()(),p(9,ue,2,0,"div",6)(10,be,2,1,"div",7)(11,_e,2,0,"div",8)(12,ye,13,10,"div",9)(13,ke,7,4,"div",10),r()),e&2&&(n(3),R(a.avgRating),n(3),l("ngForOf",S(8,ce)),n(2),c("",a.totalReviews," reviews"),n(),l("ngIf",a.isLoading),n(),l("ngIf",a.errorMessage),n(),l("ngIf",!a.isLoading&&a.reviews.length===0),n(),l("ngForOf",a.reviews),n(),l("ngIf",a.totalPages>1))},dependencies:[y,E,h,z],encapsulation:2})};function Ce(t,i){t&1&&(o(0,"div",8),s(1," Loading book... "),r())}function Ie(t,i){if(t&1&&(o(0,"div",9),s(1),r()),t&2){let e=d();n(),c(" ",e.errorMessage," ")}}function Re(t,i){if(t&1&&L(0,"img",25),t&2){let e=d(2);l("src",e.book.book_cover_url,N)("alt",e.book.book_title)}}function Se(t,i){t&1&&(o(0,"div",26),s(1," No cover "),r())}function Me(t,i){if(t&1&&(o(0,"div",27)(1,"h2",28),s(2,"Description"),r(),o(3,"p",29),s(4),r()()),t&2){let e=d(2);n(4),R(e.book.description)}}function Ee(t,i){if(t&1&&(o(0,"p",30),s(1),r()),t&2){let e=d(2);n(),R(e.addToCartError)}}function Pe(t,i){t&1&&(o(0,"p",19),s(1,"Out of stock."),r())}function Te(t,i){if(t&1){let e=f();o(0,"div",10)(1,"div",11)(2,"div",12),p(3,Re,1,2,"img",13)(4,Se,2,0,"div",14),r()(),o(5,"div",15)(6,"div")(7,"h1",16),s(8),r()(),o(9,"div",17)(10,"span",18),s(11),M(12,"currency"),r(),o(13,"span",19),s(14),r()(),p(15,Me,5,1,"div",20),o(16,"div",21)(17,"button",22),g("click",function(){v(e);let m=d();return x(m.addToCart())}),s(18),r(),p(19,Ee,2,1,"p",23)(20,Pe,2,0,"p",24),r()()()}if(t&2){let e=d();n(3),l("ngIf",e.book.book_cover_url),n(),l("ngIf",!e.book.book_cover_url),n(4),c(" ",e.book.book_title," "),n(3),c(" ",H(12,10,e.book.price)," "),n(3),c(" In stock: ",e.book.stock," "),n(),l("ngIf",e.book.description),n(2),l("disabled",e.addToCartPending||e.book.stock<1),n(),c(" ",e.addToCartPending?"Adding...":"Add to cart"," "),n(),l("ngIf",e.addToCartError),n(),l("ngIf",e.book.stock<1)}}function Le(t,i){if(t&1){let e=f();o(0,"div",31)(1,"div",32)(2,"div",33)(3,"app-review-form",34),g("reviewAdded",function(){v(e);let m=V(6);return x(m.loadReviews())}),r()(),o(4,"div",35),L(5,"app-review-list",36,0),r()()()}if(t&2){let e=d();n(3),l("bookId",e.book._id),n(2),l("bookId",e.book._id)}}var me=class t{bookService=u(ee);cartService=u(ae);route=u(J);router=u(K);cdr=u(w);book=null;isLoading=!1;errorMessage="";addToCartPending=!1;addToCartError="";ngOnInit(){let i=this.route.snapshot.paramMap.get("id");if(!i){this.errorMessage="Book not found.";return}this.loadBook(i)}loadBook(i){this.isLoading=!0,this.errorMessage="",this.bookService.getBook(i).subscribe({next:e=>{this.book=e,this.isLoading=!1,this.cdr.detectChanges()},error:()=>{this.errorMessage="Failed to load book.",this.isLoading=!1,this.cdr.detectChanges()}})}addToCart(){this.book&&(this.addToCartPending=!0,this.addToCartError="",this.cartService.addToCart(this.book._id,1,this.book.price).subscribe({next:()=>{this.addToCartPending=!1,this.cdr.detectChanges(),this.router.navigate(["/cart"])},error:()=>{this.addToCartError="Could not add to cart.",this.addToCartPending=!1,this.cdr.detectChanges()}}))}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-book-detail"]],decls:8,vars:4,consts:[["reviewList",""],[1,"bg-light","min-h-[calc(100vh-80px)]","flex","flex-col","pt-16"],[1,"max-w-4xl","mx-auto","px-6","w-full","flex","flex-col","gap-8"],["routerLink","/books",1,"text-sm","text-primary","font-semibold","no-underline","hover:text-primaryHover"],["class","text-textSub",4,"ngIf"],["class","text-error",4,"ngIf"],["class","flex flex-col md:flex-row gap-8 bg-white rounded-2xl border border-gray-100 p-6",4,"ngIf"],["class","flex flex-col gap-8 w-full mt-8 mb-24",4,"ngIf"],[1,"text-textSub"],[1,"text-error"],[1,"flex","flex-col","md:flex-row","gap-8","bg-white","rounded-2xl","border","border-gray-100","p-6"],[1,"w-full","md:w-64","flex-shrink-0"],[1,"w-full","h-80","bg-gray-100","rounded-xl","overflow-hidden","flex","items-center","justify-center"],["class","w-full h-full object-cover",3,"src","alt",4,"ngIf"],["class","w-full h-full bg-gray-200 flex items-center justify-center text-gray-400",4,"ngIf"],[1,"flex-1","flex","flex-col","gap-4"],[1,"text-2xl","md:text-3xl","font-extrabold","text-textMain","leading-tight"],[1,"flex","items-center","gap-4"],[1,"text-2xl","font-extrabold","text-price"],[1,"text-sm","text-textSub"],["class","text-textSub text-sm leading-relaxed",4,"ngIf"],[1,"flex","flex-col","gap-2"],["type","button",1,"w-full","md:w-auto","px-6","py-3","rounded-xl","text-sm","font-semibold","text-white","no-underline","bg-primary","hover:bg-primaryHover","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],["class","text-sm text-error",4,"ngIf"],["class","text-sm text-textSub",4,"ngIf"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"w-full","h-full","bg-gray-200","flex","items-center","justify-center","text-gray-400"],[1,"text-textSub","text-sm","leading-relaxed"],[1,"text-base","font-semibold","text-textMain","mb-1"],[1,"whitespace-pre-wrap"],[1,"text-sm","text-error"],[1,"flex","flex-col","gap-8","w-full","mt-8","mb-24"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-8"],[1,"col-span-1","lg:col-span-5","border","border-gray-100","rounded-2xl","p-6","bg-white","h-fit","shadow-sm"],[3,"reviewAdded","bookId"],[1,"col-span-1","lg:col-span-7","border","border-gray-100","rounded-2xl","p-6","bg-white","shadow-sm"],[3,"bookId"]],template:function(e,a){e&1&&(o(0,"div",1)(1,"div",2)(2,"a",3),s(3," \u2190 Back to all books "),r(),p(4,Ce,2,0,"div",4)(5,Ie,2,1,"div",5)(6,Te,21,12,"div",6)(7,Le,7,2,"div",7),r()()),e&2&&(n(4),l("ngIf",a.isLoading),n(),l("ngIf",!a.isLoading&&a.errorMessage),n(),l("ngIf",!a.isLoading&&!a.errorMessage&&a.book),n(),l("ngIf",!a.isLoading&&!a.errorMessage&&a.book))},dependencies:[y,h,X,Q,P,T,Y],encapsulation:2})};export{me as BookDetailPage};
