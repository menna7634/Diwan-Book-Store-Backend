import{b as R}from"./chunk-5JUGGBCD.js";import{a as D,c as z,f as U,h as G,l as J,m as K,n as Q,s as X}from"./chunk-YB375EBC.js";import{$a as W,Da as C,Fa as E,Ga as O,J as S,Ka as T,L as s,Oa as H,P as M,Pa as N,T as P,Ua as A,Va as F,aa as c,ba as n,bb as j,ca as r,cb as V,da as B,fb as q,ja as I,ka as m,la as g,qa as a,sa as f,ta as L,v as p,va as h,w as k,wa as x,x as w,xa as b}from"./chunk-VTSCHVBM.js";var Z=o=>["/books",o];function $(o,t){o&1&&(n(0,"div",26),a(1," Loading books... "),r())}function ee(o,t){if(o&1&&(n(0,"div",27),a(1),r()),o&2){let e=g();s(),f(" ",e.errorMessage," ")}}function te(o,t){o&1&&(n(0,"div",26),a(1," No books found. "),r())}function ie(o,t){if(o&1&&B(0,"img",39),o&2){let e=g().$implicit;c("src",e.book_cover_url,S)("alt",e.book_title)}}function ne(o,t){o&1&&(n(0,"div",40),a(1," No cover "),r())}function re(o,t){if(o&1&&(n(0,"a",30)(1,"div",31),P(2,ie,1,2,"img",32)(3,ne,2,0,"div",33),r(),n(4,"div",34)(5,"h3",35),a(6),r(),n(7,"div",36)(8,"span",37),a(9),E(10,"currency"),r(),n(11,"span",38),a(12),r()()()()),o&2){let e=t.$implicit;c("routerLink",C(8,Z,e._id)),s(2),c("ngIf",e.book_cover_url),s(),c("ngIf",!e.book_cover_url),s(3),f(" ",e.book_title," "),s(3),f(" ",O(10,6,e.price)," "),s(3),f(" In stock: ",e.stock," ")}}function oe(o,t){if(o&1&&(n(0,"div",28),P(1,re,13,10,"a",29),r()),o&2){let e=g();s(),c("ngForOf",e.books)}}function ae(o,t){if(o&1){let e=I();n(0,"div",41)(1,"button",42),m("click",function(){k(e);let d=g();return w(d.previousPage())}),a(2," Previous "),r(),n(3,"span",43),a(4),r(),n(5,"button",44),m("click",function(){k(e);let d=g();return w(d.nextPage())}),a(6," Next "),r()()}if(o&2){let e=g();s(),c("disabled",!e.pagination.hasPrevPage),s(3),L(" Page ",e.pagination.page," of ",e.pagination.totalPages," "),s(),c("disabled",!e.pagination.hasNextPage)}}var Y=class o{bookService=p(R);route=p(W);router=p(j);cdr=p(T);books=[];pagination=null;isLoading=!1;errorMessage="";search="";authorIds=null;minPrice=null;maxPrice=null;sortOption="newest";ngOnInit(){this.route.queryParamMap.subscribe(t=>{let e=Number(t.get("page"))||1,i=Number(t.get("limit"))||12,d=t.get("search")||"",l=t.get("authorIds")||null,v=t.get("minPrice"),_=t.get("maxPrice"),y=t.get("sort")||null,u=t.get("order")||null;this.search=d,this.authorIds=l,this.minPrice=v!==null?Number(v):null,this.maxPrice=_!==null?Number(_):null,this.sortOption=this.mapSortOrderToOption(y,u),this.loadBooks(e,i,d,l,this.minPrice,this.maxPrice,y,u)})}loadBooks(t,e,i,d,l,v,_,y){this.isLoading=!0,this.errorMessage="",this.bookService.getBooks({page:t,limit:e,search:i||void 0,authorIds:d||void 0,minPrice:l??void 0,maxPrice:v??void 0,sort:_||void 0,order:y||void 0}).subscribe({next:u=>{this.books=u.data,this.pagination=u.pagination,this.isLoading=!1,this.cdr.detectChanges()},error:()=>{this.errorMessage="Failed to load books.",this.isLoading=!1,this.cdr.detectChanges()}})}applyFilters(){let{sort:t,order:e}=this.mapOptionToSortOrder(this.sortOption);this.router.navigate(["/books"],{queryParams:{page:1,search:this.search||null,authorIds:this.authorIds??null,minPrice:this.minPrice??null,maxPrice:this.maxPrice??null,sort:t,order:e},queryParamsHandling:"merge"})}clearFilters(){this.search="",this.authorIds=null,this.minPrice=null,this.maxPrice=null,this.sortOption="newest",this.router.navigate(["/books"],{queryParams:{page:1,search:null,authorIds:null,minPrice:null,maxPrice:null,sort:null,order:null},queryParamsHandling:"merge"})}goToPage(t){this.pagination&&(t<1||t>this.pagination.totalPages||this.router.navigate(["/books"],{queryParams:{page:t},queryParamsHandling:"merge"}))}nextPage(){this.pagination?.hasNextPage&&this.goToPage(this.pagination.page+1)}previousPage(){this.pagination?.hasPrevPage&&this.goToPage(this.pagination.page-1)}mapSortOrderToOption(t,e){return t==="price"&&e==="asc"?"priceLowHigh":t==="price"&&e==="desc"?"priceHighLow":t==="createdAt"&&e==="asc"?"oldest":"newest"}mapOptionToSortOrder(t){switch(t){case"oldest":return{sort:"createdAt",order:"asc"};case"priceLowHigh":return{sort:"price",order:"asc"};case"priceHighLow":return{sort:"price",order:"desc"};default:return{sort:"createdAt",order:"desc"}}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=M({type:o,selectors:[["app-books-page"]],decls:46,vars:9,consts:[[1,"bg-light","min-h-[calc(100vh-80px)]","flex","flex-col","pt-16"],[1,"max-w-6xl","mx-auto","px-6","w-full","flex","flex-col","gap-8"],[1,"flex","items-center","justify-between"],[1,"text-3xl","font-extrabold","text-textMain","tracking-tight"],[1,"flex","flex-col","md:flex-row","gap-8"],[1,"flex-1","flex","flex-col","gap-6"],["class","text-textSub",4,"ngIf"],["class","text-error",4,"ngIf"],["class","grid grid-cols-2 md:grid-cols-3 gap-6",4,"ngIf"],["class","flex items-center justify-between mt-4",4,"ngIf"],[1,"w-full","md:w-64","bg-white","border","border-gray-100","rounded-2xl","p-4","h-fit"],[1,"text-lg","font-semibold","text-textMain","mb-4"],[1,"flex","flex-col","gap-4","text-sm"],[1,"block","font-medium","mb-1"],["type","text",1,"w-full","border","border-gray-300","rounded-lg","min-h-9","px-2","py-1","focus:ring-2","focus:ring-primary","focus:border-transparent","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"flex-1"],["type","number",1,"w-full","border","border-gray-300","rounded-lg","min-h-9","px-2","py-1","focus:ring-2","focus:ring-primary","focus:border-transparent","outline-none","transition-all",3,"ngModelChange","ngModel"],[1,"w-full","border","border-gray-300","rounded-lg","min-h-9","px-2","py-1","bg-white","focus:ring-2","focus:ring-primary","focus:border-transparent","outline-none","transition-all",3,"ngModelChange","ngModel"],["value","newest"],["value","oldest"],["value","priceLowHigh"],["value","priceHighLow"],[1,"flex","gap-2","mt-2"],["type","button",1,"flex-1","px-3","py-2","rounded-xl","text-sm","font-semibold","no-underline","bg-white","border","border-gray-200","text-textMain","hover:bg-gray-50",3,"click"],["type","button",1,"flex-1","px-3","py-2","rounded-xl","text-sm","font-semibold","text-white","no-underline","bg-primary","hover:bg-primaryHover",3,"click"],[1,"text-textSub"],[1,"text-error"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-6"],["class","group bg-white rounded-2xl border border-gray-100 overflow-hidden hover:shadow-xl hover:border-primary/20 transition-all duration-300 flex flex-col h-full cursor-pointer no-underline text-inherit",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","bg-white","rounded-2xl","border","border-gray-100","overflow-hidden","hover:shadow-xl","hover:border-primary/20","transition-all","duration-300","flex","flex-col","h-full","cursor-pointer","no-underline","text-inherit",3,"routerLink"],[1,"h-64","bg-gray-100","w-full","relative","flex","items-center","justify-center","p-2"],["class","w-full h-full object-contain rounded",3,"src","alt",4,"ngIf"],["class","w-full h-full bg-gray-200 rounded shadow-sm flex items-center justify-center text-gray-400",4,"ngIf"],[1,"p-5","flex","flex-col","flex-grow"],[1,"font-bold","text-textMain","text-base","leading-snug","line-clamp-2","md:h-12","mb-1","group-hover:text-primary","transition-colors"],[1,"mt-auto","flex","items-center","justify-between"],[1,"font-extrabold","text-lg","text-price"],[1,"text-xs","text-textSub"],[1,"w-full","h-full","object-contain","rounded",3,"src","alt"],[1,"w-full","h-full","bg-gray-200","rounded","shadow-sm","flex","items-center","justify-center","text-gray-400"],[1,"flex","items-center","justify-between","mt-4"],["type","button",1,"px-4","py-2","rounded-xl","text-sm","font-semibold","no-underline","bg-white","border","border-gray-200","text-textMain","hover:bg-gray-50","disabled:opacity-50",3,"click","disabled"],[1,"text-sm","text-textSub"],["type","button",1,"px-4","py-2","rounded-xl","text-sm","font-semibold","text-white","no-underline","bg-primary","hover:bg-primaryHover","disabled:opacity-50",3,"click","disabled"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"All Books"),r()(),n(5,"div",4)(6,"div",5),P(7,$,2,0,"div",6)(8,ee,2,1,"div",7)(9,te,2,0,"div",6)(10,oe,2,1,"div",8)(11,ae,7,4,"div",9),r(),n(12,"aside",10)(13,"h2",11),a(14,"Filters"),r(),n(15,"div",12)(16,"div")(17,"label",13),a(18,"Search"),r(),n(19,"input",14),b("ngModelChange",function(l){return x(i.search,l)||(i.search=l),l}),r()(),n(20,"div",15)(21,"div",16)(22,"label",13),a(23,"Min price"),r(),n(24,"input",17),b("ngModelChange",function(l){return x(i.minPrice,l)||(i.minPrice=l),l}),r()(),n(25,"div",16)(26,"label",13),a(27,"Max price"),r(),n(28,"input",17),b("ngModelChange",function(l){return x(i.maxPrice,l)||(i.maxPrice=l),l}),r()()(),n(29,"div")(30,"label",13),a(31,"Sort by"),r(),n(32,"select",18),b("ngModelChange",function(l){return x(i.sortOption,l)||(i.sortOption=l),l}),n(33,"option",19),a(34,"Newest"),r(),n(35,"option",20),a(36,"Oldest"),r(),n(37,"option",21),a(38,"Price: Low to High"),r(),n(39,"option",22),a(40,"Price: High to Low"),r()()(),n(41,"div",23)(42,"button",24),m("click",function(){return i.clearFilters()}),a(43," Clear "),r(),n(44,"button",25),m("click",function(){return i.applyFilters()}),a(45," Apply "),r()()()()()()()),e&2&&(s(7),c("ngIf",i.isLoading),s(),c("ngIf",!i.isLoading&&i.errorMessage),s(),c("ngIf",!i.isLoading&&!i.errorMessage&&i.books.length===0),s(),c("ngIf",!i.isLoading&&!i.errorMessage&&i.books.length>0),s(),c("ngIf",i.pagination&&i.pagination.totalPages>1),s(8),h("ngModel",i.search),s(5),h("ngModel",i.minPrice),s(4),h("ngModel",i.maxPrice),s(4),h("ngModel",i.sortOption))},dependencies:[F,H,N,q,V,X,K,Q,D,G,J,z,U,A],encapsulation:2})};export{Y as BooksPage};
